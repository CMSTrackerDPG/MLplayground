{% extends 'base_with_sidebar.html' %}
{% load static %}

{% block extra_head %}
<!-- <script src="https://unpkg.com/vue@3"></script> -->
<!-- <script src="https://unpkg.com/axios/dist/axios.min.js"></script> -->
{% endblock %}

{% block title %}
{{ title }}, run {{ runnr }}{% if lumisection %}, lumisection {{ lumisection }}{% endif %}
{% endblock %}

{% block maincontent %}
{% if data %}
<div id="histogram-show" style="height: 700px;">
    <script>
        var trace = {
            x: {{ bins }},
            y: {{ data }},
            type: 'bar'
        };
        var data = [trace];

        Plotly.newPlot('histogram-show', data, 
        {
            bargap: 0, 
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            title: {
                text:'{{ title }}<br>Run {{ runnr }}{% if lumisection %}, lumisection {{ lumisection }}{% endif %}',
                xref: 'paper',
                x: 0
            }
        }, {responsive: true});
    </script>
</div>
{% elif data2d %}
<div id="histogram-show" style="height: 700px;">
    <script>
        var data = [
            {
                z: {{ data2d }},
                x: {{ xbins }},
                y: {{ ybins }},
                type: 'heatmap',
                colorscale: 'Viridis'
            }
        ];

        Plotly.newPlot('histogram-show', data, 
        {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            title: {
                text:'{{ title }}<br>Run {{ runnr }}{% if lumisection %}, lumisection {{ lumisection }}{% endif %}',
                xref: 'paper',
                x: 0
            }
        }, {responsive: true});
    </script>
</div>
{% else %}
<div class="alert alert-danger">
    <h2>No histogram found.</h2>
    Check the spelling of the above URL and try again. Based on the URL, here are the queries you have requested:
    <ol>
        <li>Run: <code>{{runnr}}</code></li>
        {% if lumisection %}<li>Lumisection: <code>{{lumisection}}</code></li>{% endif %}
        <li>Title: <code>{{title}}</code></li>
    </ol>
</div>
{% endif %}
{% endblock %}

{% block sidebar %}
<h2>More from OMS</h2>
<a class="nav-link" href="https://cmsoms.cern.ch/cms/runs/report?cms_run={{runnr}}">Run {{runnr}}</a>
<a class="nav-link" href="https://cmsoms.cern.ch/cms/triggers/l1_rates?cms_run={{runnr}}">L1 rates from run {{runnr}}</a>
<a class="nav-link" href="https://cmsoms.cern.ch/cms/triggers/hlt_trigger_rates?cms_run={{runnr}}">HLT rates from run {{runnr}}</a>

{% endblock %}

{% block scripts %}

{% endblock %}
